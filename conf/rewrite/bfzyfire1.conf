    # 允许所有Cloudflare CDN的IP地址访问
    allow 103.21.244.0/22;
    allow 103.22.200.0/22;
    allow 103.31.4.0/22;
    allow 104.16.0.0/12;
    allow 108.162.192.0/18;
    allow 131.0.72.0/22;
    allow 141.101.64.0/18;
    allow 162.158.0.0/15;
    allow 172.64.0.0/13;
    allow 173.245.48.0/20;
    allow 188.114.96.0/20;
    allow 190.93.240.0/20;
    allow 197.234.240.0/22;
    allow 198.41.128.0/17;
    allow 199.27.128.0/21;
    allow 2400:cb00::/32;
    allow 2405:b500::/32;
    allow 2606:4700::/32;
    allow 2803:f800::/32;
    allow 2c0f:f248::/32;
    allow 2a06:98c0::/29;

    # 禁止所有其他IP地址访问
    deny all;
access_by_lua_block {
                -- 获取当前网址
                function get_current_url()
                    local full_url = ngx.var.request_uri
-- 获取路径部分（不包含GET参数）
local path = string.match(full_url, "([^?]+)")
return path  
           end

function isApiPathEqual(str)
    local paths = {
"/test/a/v/",
"/api.php/Seacms/vod/","/api.php/Seacms/vod",
	"/api.php/provide/vod",
        "/api.php/provide/vod/",
        "/api.php/provide/vod/at/xml",
        "/api.php/provide/vod/at/xml/",
  "/api.php/provide/vod/at/json",
        "/api.php/provide/vod/at/json/"

    }

    for i, path in ipairs(paths) do
        if str == path then
            return true
        end
    end
    return false
end


 local dict = ngx.shared.req_count
        local ip = ngx.var.remote_addr
        local count = dict:get(ip) or 0
        
        if count >= 10 then
          ngx.exit(444)
        end
        
        dict:incr(ip, 1)
        dict:expire(ip, 3600)

                ngx.req.read_body() -- 读取请求 body，如果需要获取 POST 参数的话
                local current_url = get_current_url()
     if not  isApiPathEqual( current_url) then
        ngx.header.content_type = "text/html"
ngx.say(current_url)
    ngx.exit(444)
end    



            }
