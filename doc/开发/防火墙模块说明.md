# é˜²ç«å¢™æ¨¡å—ä½¿ç”¨è¯´æ˜

## ğŸ“¦ æ¨¡å—ä¿¡æ¯

- **æ–‡ä»¶**: `scripts/debian12/firewall_simple.sh`
- **ç±»å‹**: å…¨å±€é€šç”¨æ¨¡å—
- **ä¾èµ–**: iptables, iptables-persistent

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### 1. è‡ªåŠ¨åŒ–é…ç½®
- âœ… å®‰è£… iptables å’ŒæŒä¹…åŒ–å·¥å…·
- âœ… è‡ªåŠ¨æ£€æµ‹å¹¶ç¦ç”¨ ufw
- âœ… é…ç½®åŸºç¡€å®‰å…¨è§„åˆ™
- âœ… è‡ªåŠ¨ä¿å­˜è§„åˆ™ï¼ˆæŒä¹…åŒ–ï¼‰

### 2. å®‰å…¨è§„åˆ™
- âœ… å…è®¸æœ¬åœ°å›ç¯æ¥å£ï¼ˆloï¼‰
- âœ… å…è®¸å·²å»ºç«‹çš„è¿æ¥ï¼ˆESTABLISHED,RELATEDï¼‰
- âœ… ä¿æŠ¤ SSH ç«¯å£ï¼ˆ22ï¼‰é˜²æ­¢é”æ­»
- âœ… å¼€æ”¾ Web ç«¯å£ï¼ˆ80ã€443ï¼‰

### 3. å‚æ•°éªŒè¯
- âœ… ç«¯å£å·æ ¼å¼éªŒè¯
- âœ… åè®®å‚æ•°éªŒè¯
- âœ… é‡å¤è§„åˆ™æ£€æŸ¥

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹å¼ä¸€ï¼šå®Œæ•´é…ç½®ï¼ˆæ¨èç”¨äºæ–°ç³»ç»Ÿï¼‰

```bash
# åŠ è½½æ¨¡å—
source scripts/debian12/firewall_simple.sh

# ä¸€é”®å®Œæ•´é…ç½®
setup_firewall_full

# åŒ…å«ï¼š
# - å®‰è£… iptables
# - ç¦ç”¨ ufw
# - é…ç½®åŸºç¡€è§„åˆ™
# - å¼€æ”¾ Web ç«¯å£
# - æ˜¾ç¤ºè§„åˆ™
```

### æ–¹å¼äºŒï¼šåˆ†æ­¥é…ç½®

```bash
# 1. å®‰è£…é˜²ç«å¢™å·¥å…·
setup_firewall

# 2. é…ç½®åŸºç¡€è§„åˆ™
setup_basic_firewall_rules

# 3. å¼€æ”¾ Web ç«¯å£
open_web_ports

# 4. æŸ¥çœ‹è§„åˆ™
show_firewall_rules
```

### æ–¹å¼ä¸‰ï¼šå¿«é€Ÿå¼€æ”¾ç«¯å£

```bash
# åŠ è½½æ¨¡å—
source scripts/debian12/firewall_simple.sh

# å¿«é€Ÿå¼€æ”¾ç«¯å£ï¼ˆè‡ªåŠ¨æŒä¹…åŒ–ï¼‰
quick_open_port 8080 tcp "è‡ªå®šä¹‰æœåŠ¡"
quick_open_port 3306 tcp "MySQL"
quick_open_port 6379 tcp "Redis"
```

## ğŸ“š å‡½æ•°è¯´æ˜

### setup_firewall()
å®‰è£… iptables å¹¶ç¦ç”¨ ufw

```bash
setup_firewall
```

**åŠŸèƒ½**:
- å®‰è£… iptables-persistent
- æ£€æµ‹å¹¶åœæ­¢ ufw æœåŠ¡
- ç¦ç”¨ ufw å¼€æœºè‡ªå¯

---

### open_port(port, protocol, comment)
å¼€æ”¾æŒ‡å®šç«¯å£

**å‚æ•°**:
- `port`: ç«¯å£å·ï¼ˆå¿…éœ€ï¼Œæ•°å­—ï¼‰
- `protocol`: åè®®ç±»å‹ï¼ˆé»˜è®¤: tcpï¼‰
- `comment`: æ³¨é‡Šè¯´æ˜ï¼ˆå¯é€‰ï¼‰

**ç¤ºä¾‹**:
```bash
open_port 80 tcp "HTTP"
open_port 443 tcp "HTTPS"
open_port 53 udp "DNS"
```

**ç‰¹æ€§**:
- è‡ªåŠ¨æ£€æŸ¥è§„åˆ™æ˜¯å¦å·²å­˜åœ¨
- å‚æ•°éªŒè¯ï¼ˆç«¯å£å¿…é¡»æ˜¯æ•°å­—ï¼‰
- é‡å¤è°ƒç”¨ä¸ä¼šåˆ›å»ºé‡å¤è§„åˆ™

---

### save_firewall_rules()
ä¿å­˜ iptables è§„åˆ™ï¼ˆæŒä¹…åŒ–ï¼‰

```bash
save_firewall_rules
```

**ä¿å­˜æ–¹å¼**:
1. ä¼˜å…ˆä½¿ç”¨ `netfilter-persistent save`
2. å¤‡ç”¨æ–¹å¼ï¼š`iptables-save > /etc/iptables/rules.v4`

---

### setup_basic_firewall_rules()
é…ç½®åŸºç¡€é˜²ç«å¢™è§„åˆ™

```bash
setup_basic_firewall_rules
```

**åŒ…å«è§„åˆ™**:
- å…è®¸ loopback æ¥å£
- å…è®¸å·²å»ºç«‹çš„è¿æ¥
- å…è®¸ SSHï¼ˆç«¯å£ 22ï¼‰

---

### open_web_ports()
å¼€æ”¾ Web ç«¯å£å¹¶æŒä¹…åŒ–

```bash
open_web_ports
```

**å¼€æ”¾ç«¯å£**:
- 80/tcp (HTTP)
- 443/tcp (HTTPS)

---

### quick_open_port(port, protocol, comment)
å¿«é€Ÿå¼€æ”¾ç«¯å£å¹¶è‡ªåŠ¨æŒä¹…åŒ–

**å‚æ•°**: åŒ `open_port()`

**ç¤ºä¾‹**:
```bash
quick_open_port 8443 tcp "Trojan-Go"
```

**ä¼˜åŠ¿**: ä¸€æ¬¡è°ƒç”¨å®Œæˆå¼€æ”¾å’Œä¿å­˜

---

### show_firewall_rules()
æ˜¾ç¤ºå½“å‰é˜²ç«å¢™è§„åˆ™

```bash
show_firewall_rules
```

**è¾“å‡º**: è¯¦ç»†çš„ iptables INPUT é“¾è§„åˆ™

## ğŸ”§ é›†æˆç¤ºä¾‹

### åœ¨ Trojan-Go ä¸­çš„ä½¿ç”¨

```bash
# main.sh ä¸­åŠ è½½æ¨¡å—
source "${SCRIPT_DIR}/../firewall_simple.sh"

# å®‰è£…æµç¨‹ä¸­è°ƒç”¨
setup_firewall
setup_basic_firewall_rules
open_web_ports
```

### åœ¨å…¶ä»–ç»„ä»¶ä¸­ä½¿ç”¨

```bash
# åŠ è½½æ¨¡å—
source scripts/debian12/firewall_simple.sh

# å¼€æ”¾è‡ªå®šä¹‰ç«¯å£
quick_open_port 3000 tcp "Node.js App"
quick_open_port 8080 tcp "Tomcat"
```

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### 1. é˜²æ­¢é”æ­»
- è‡ªåŠ¨ä¿æŠ¤ SSH ç«¯å£ï¼ˆ22ï¼‰
- å…è®¸å·²å»ºç«‹çš„è¿æ¥ç»§ç»­é€šä¿¡
- é…ç½®å‰ä¸ä¼šæ¸…ç©ºç°æœ‰è§„åˆ™

### 2. å‚æ•°éªŒè¯
```bash
# ç«¯å£å¿…é¡»æ˜¯æ•°å­—
open_port "abc" tcp  # âŒ å¤±è´¥ï¼ŒæŠ¥é”™
open_port 80 tcp     # âœ… æˆåŠŸ

# ç©ºç«¯å£æ£€æŸ¥
open_port "" tcp     # âŒ å¤±è´¥ï¼ŒæŠ¥é”™
```

### 3. é‡å¤è§„åˆ™æ£€æŸ¥
```bash
# ç¬¬ä¸€æ¬¡è°ƒç”¨
open_port 80 tcp     # æ·»åŠ è§„åˆ™

# ç¬¬äºŒæ¬¡è°ƒç”¨
open_port 80 tcp     # è·³è¿‡ï¼Œæç¤ºå·²å­˜åœ¨
```

## ğŸ“Š è§„åˆ™ç¤ºä¾‹

é…ç½®å®Œæˆåçš„ iptables è§„åˆ™ï¼š

```
Chain INPUT (policy ACCEPT)
num  target     prot opt source      destination
1    ACCEPT     all  --  0.0.0.0/0   0.0.0.0/0    /* loopback */
2    ACCEPT     all  --  0.0.0.0/0   0.0.0.0/0    ctstate RELATED,ESTABLISHED
3    ACCEPT     tcp  --  0.0.0.0/0   0.0.0.0/0    tcp dpt:22
4    ACCEPT     tcp  --  0.0.0.0/0   0.0.0.0/0    tcp dpt:80
5    ACCEPT     tcp  --  0.0.0.0/0   0.0.0.0/0    tcp dpt:443
```

## ğŸ” æ•…éšœæ’æŸ¥

### æ£€æŸ¥ iptables æ˜¯å¦å®‰è£…
```bash
iptables --version
```

### æŸ¥çœ‹å½“å‰è§„åˆ™
```bash
iptables -L -n -v
```

### æ£€æŸ¥è§„åˆ™æ˜¯å¦æŒä¹…åŒ–
```bash
# Debian/Ubuntu
ls -la /etc/iptables/rules.v4
cat /etc/iptables/rules.v4
```

### æ‰‹åŠ¨ä¿å­˜è§„åˆ™
```bash
netfilter-persistent save
# æˆ–
iptables-save > /etc/iptables/rules.v4
```

### æ£€æŸ¥ ufw çŠ¶æ€
```bash
systemctl status ufw
ufw status
```

### é‡å¯åè§„åˆ™ä¸¢å¤±ï¼Ÿ
```bash
# ç¡®ä¿ iptables-persistent å·²å®‰è£…
dpkg -l | grep iptables-persistent

# é‡æ–°ä¿å­˜è§„åˆ™
netfilter-persistent save

# æˆ–å¯ç”¨ netfilter-persistent æœåŠ¡
systemctl enable netfilter-persistent
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **SSH å®‰å…¨**: æ¨¡å—é»˜è®¤å¼€æ”¾ SSHï¼ˆ22ï¼‰ï¼Œç¡®ä¿è¿œç¨‹è¿æ¥ä¸ä¼šæ–­å¼€

2. **ufw å†²çª**: å¦‚æœç³»ç»Ÿä½¿ç”¨ ufwï¼Œæ¨¡å—ä¼šè‡ªåŠ¨ç¦ç”¨ï¼Œé¿å…è§„åˆ™å†²çª

3. **è§„åˆ™é¡ºåº**: iptables è§„åˆ™æŒ‰é¡ºåºåŒ¹é…ï¼ŒåŸºç¡€è§„åˆ™ï¼ˆå›ç¯ã€å·²å»ºç«‹è¿æ¥ï¼‰åº”åœ¨æœ€å‰é¢

4. **æŒä¹…åŒ–**: ä½¿ç”¨ `open_port()` åå¿…é¡»è°ƒç”¨ `save_firewall_rules()`ï¼Œæˆ–ç›´æ¥ä½¿ç”¨ `quick_open_port()`

5. **æµ‹è¯•å»ºè®®**: åœ¨æµ‹è¯•ç¯å¢ƒå…ˆéªŒè¯è§„åˆ™ï¼Œé¿å…åœ¨ç”Ÿäº§ç¯å¢ƒé”æ­»

## ğŸ¯ æœ€ä½³å®è·µ

### 1. æ–°ç³»ç»Ÿåˆå§‹åŒ–
```bash
# ä½¿ç”¨ä¸€é”®é…ç½®
setup_firewall_full
```

### 2. æ·»åŠ è‡ªå®šä¹‰ç«¯å£
```bash
# ä½¿ç”¨å¿«é€Ÿæ–¹æ³•
quick_open_port 8443 tcp "Trojan-Go Internal"
```

### 3. æ‰¹é‡é…ç½®ç«¯å£
```bash
# å®šä¹‰ç«¯å£åˆ—è¡¨
declare -A ports=(
    [80]="HTTP"
    [443]="HTTPS"
    [3000]="Node.js"
    [8080]="Tomcat"
)

# æ‰¹é‡å¼€æ”¾
for port in "${!ports[@]}"; do
    open_port "$port" tcp "${ports[$port]}"
done

# ç»Ÿä¸€ä¿å­˜
save_firewall_rules
```

### 4. æŸ¥çœ‹å¹¶éªŒè¯
```bash
# å¼€æ”¾ç«¯å£åç«‹å³æŸ¥çœ‹
open_web_ports
show_firewall_rules
```

## ğŸ“¦ ä¾èµ–é¡¹

- iptables
- iptables-persistent (netfilter-persistent)
- Debian 11+ / Ubuntu 20.04+

## ğŸ”— ç›¸å…³æ¨¡å—

- **ssl.sh**: SSL è¯ä¹¦ç®¡ç†
- **trojan-go/main.sh**: Trojan-Go éƒ¨ç½²ï¼ˆå·²é›†æˆé˜²ç«å¢™æ¨¡å—ï¼‰

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0 (2025-12-04)
- âœ… åˆå§‹ç‰ˆæœ¬
- âœ… æ”¯æŒ iptables é…ç½®
- âœ… è‡ªåŠ¨ç¦ç”¨ ufw
- âœ… è§„åˆ™æŒä¹…åŒ–
- âœ… å‚æ•°éªŒè¯
- âœ… é›†æˆåˆ° Trojan-Go éƒ¨ç½²æµç¨‹
